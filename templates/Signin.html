<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sign In Page</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'signin.css' %}" />
  </head>
  <body>
    <div class="bg"></div>
    <div class="bg bg2"></div>
    <div class="bg bg3"></div>
    <header>Skin Cancer Detection & Classification</header>

    <div class="translate-container">
      <button class="translate-button" onclick="toggleTranslate()">
        üåê Translate
      </button>
      <div id="google_translate_element" style="display: none"></div>
    </div>

    <div class="container">
      <div class="image-container">
        <img src="/static/logo.png" alt="Skin Cancer Detection Image" />
      </div>

      <div class="form-container">
        <h2>Sign Up</h2>
        {% if request.GET.error == 'username_exists' %}
        <p class="error-banner">
          Username already exists! Please choose another.
        </p>
        {% elif request.GET.error == 'email_exists' %}
        <p class="error-banner">
          Email already exists! Please use another email.
        </p>
        {% endif %}
        <form action="/signin_api/" method="post" id="signupForm">
          {% csrf_token %}
          <div class="input-container">
            <input
              type="text"
              id="username"
              name="username"
              placeholder="Username"
            />
            <p id="usernameError" class="error-message"></p>
          </div>
          <div class="input-container">
            <input type="email" id="email" name="email" placeholder="Email" />
            <p id="emailError" class="error-message"></p>
          </div>
          <div class="input-container">
            <input
              type="password"
              id="password"
              name="password"
              placeholder="Password"
            />
            <p id="passwordError" class="error-message"></p>
          </div>
          <div class="button-group">
            <button type="submit">Sign Up</button>
            <button type="button" onclick="location.href='/login'">
              Login
            </button>
          </div>
        </form>
      </div>
    </div>

    <footer>
      <p class="developer-text">Designed and Developed by:</p>
      <div class="developer-info">
        <p>Angel Blessy</p>
        <p>Anna Bino</p>
        <p>Bhavani K</p>
      </div>
      <p>
        Need help? Visit our <a href="sup">Support Page</a> or
        <a href="contact">Contact Us</a>.
      </p>
    </footer>

    <script>
      // Add event listener to the form
      document
        .getElementById("signupForm")
        .addEventListener("submit", function (event) {
          // Call validation function and prevent submission if validation fails
          if (!validateSignUpForm()) {
            event.preventDefault();
          }
        });

      function validateSignUpForm() {
        let username = document.getElementById("username").value.trim();
        let email = document.getElementById("email").value.trim();
        let password = document.getElementById("password").value.trim();

        let usernameError = document.getElementById("usernameError");
        let emailError = document.getElementById("emailError");
        let passwordError = document.getElementById("passwordError");

        let emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        let passwordPattern = /^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{8,}$/;

        // Reset previous error messages
        usernameError.textContent = "";
        emailError.textContent = "";
        passwordError.textContent = "";

        let isValid = true;

        // Username validation
        if (username.length < 3) {
          usernameError.textContent =
            "Username must be at least 3 characters long.";
          isValid = false;
        }

        // Email validation
        if (!emailPattern.test(email)) {
          emailError.textContent =
            "Invalid email format. Please enter a valid email like example@mail.com.";
          isValid = false;
        }

        // Password validation
        if (!passwordPattern.test(password)) {
          passwordError.textContent =
            "Password must be at least 8 characters long and contain both letters and numbers.";
          isValid = false;
        }

        return isValid;
      }
    </script>

    <script>
      function toggleTranslate() {
        var element = document.getElementById("google_translate_element");
        if (element.style.display === "none") {
          element.style.display = "block";
        } else {
          element.style.display = "none";
        }
      }

      function googleTranslateElementInit() {
        new google.translate.TranslateElement(
          {
            pageLanguage: "en",
            includedLanguages: "hi,bn,te,mr,ta,ur,gu,ml,kn,pa,or,as", // Indian languages
            layout: google.translate.TranslateElement.InlineLayout.SIMPLE,
          },
          "google_translate_element"
        );

        // Apply saved translation language
        var lang = localStorage.getItem("selectedLanguage");
        if (lang) {
          setTimeout(() => {
            document.querySelector("select.goog-te-combo").value = lang;
            document
              .querySelector("select.goog-te-combo")
              .dispatchEvent(new Event("change"));
          }, 2000); // Delay to ensure translation loads
        }
      }

      // Listen for language selection and store in localStorage
      document.addEventListener("change", function (event) {
        if (event.target.classList.contains("goog-te-combo")) {
          localStorage.setItem("selectedLanguage", event.target.value);
        }
      });
    </script>

    <!-- Load Google Translate API -->
    <script
      type="text/javascript"
      src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"
    ></script>
  </body>
</html>
